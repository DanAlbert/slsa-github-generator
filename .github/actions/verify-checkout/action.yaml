name: "Verify a checkout's sha"
description: "verify commit sha for a GitHub repo"

runs:
  using: "composite"
  steps:
    - name: Verify commit sha
      shell: bash
      env:
        CONTEXT: "${{ toJSON(github) }}"
      run: |
        set -euo pipefail

        git_sha=$(git log -1 --format='%H')
        if [[ "$git_sha" != "$GITHUB_SHA" ]]; then
            echo "mismatch git sha \"$git_sha\" != \"$GITHUB_SHA\""
            echo "GitHub context:"
            echo "$CONTEXT"
            echo
            echo "Last 20 commits:"
            git log -20
            exit 1
        fi
